<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="author" content="BotoX">
<meta name="description" content="Ninebot ES/SNSC Custom Firmware Toolkit">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" type="image/png" href="static/favicon.png">
<link rel="stylesheet" type="text/css" href="static/style.css">
<title>Ninebot ES/SNSC Custom Firmware Toolkit</title>
</head>

<body>

<div class="header">
    <h1>Ninebot ES/SNSC Custom Firmware Toolkit</h1>
</div>

<div class="content">
<p>
    Configure your own custom firmware by adjusting the options below.<br>
    There are safety checks in place to ensure your scooter will not be bricked.<br>
    Be aware that a higher motor power will shorten the lifetime of your battery and could damage your motor.<br>
    By default nothing will be patched, enable patches with the "Patch?" checkbox next to them.
</p>

<p>
    Presets:
    <button onclick="Preset_Default();">Default</button>
    <button onclick="Preset_Mine();">1</button>
    <button onclick="Preset_CFWW();">2</button>
    <button onclick="Preset_Rollerplausch();">3</button>
    <button onclick="Preset_DYoC();">4</button>
</p>

<noscript>This website (despite it's look) requires some very simple JavaScript which is embedded in this HTML.</noscript>

<hr>
<form action="/cfw">
<ul>
    <li><p>
        Base version of your firmware:
        <select name="version">
            <option value="DRV120">1.2.0</option>
            <option value="DRV133" selected>1.3.3</option>
        </select>
        <br>
        1.3.3 is recommended over 1.2.0, because you won't need to downgrade the BMS.
    </p></li>

    <li><p>
        KERS dividor:
        <input name="kers_min_speed" type="number" step="0.1" min="0" max="100" value="6.0" disabled>
        <label><input type="checkbox" onchange="CheckForm('kers_min_speed', this);">Patch?</label>
        <br>
        Divide KERS strengh.<br>
    </p></li>

    <li><p>
        Maximum speed:
        <input name="normal_max_speed" type="number" step="1" min="0" max="100" value="32" disabled>
        <label><input type="checkbox" onchange="CheckForm('normal_max_speed', this);">Patch?</label>
        <br>
        The scooter will stay below this speed. Use it if you're running at limited speed even in Sport mode.
    </p></li>


    <li><p>
        Motor power constant:
        <input name="motor_power_constant" type="number" step="1" min="20000" max="65535" value="51575" disabled>
        <label><input type="checkbox" onchange="CheckForm('motor_power_constant', this);">Patch?</label>
        <br>
        Lower = More power. Too much power is not recommended for battery and motor life.<br>
        Modifying this value will surely break your scooter.
    </p></li>


</ul>
<hr>

<p>
    Make sure to double check all of your entered values before submitting!<br>
    <b>I AM RESPONSIBLE FOR THE ENTERED VALUES:</b>
    <input type="submit" value="Patch!"/>
    <button type="button" onclick="Share();">Share</button>
    <span id="shareConfirmation"></span>
</p>
</form>

<p>
    <b><span style="color: red;">&#9888;&nbsp;NEW </span>The tool now makes .zip files with both encrypted and unencrypted firmware and an info.txt inside.</b><br>
    <b><span style="color: red;">&#9888;&nbsp;NEW </span>Use the following Windows app made by majsi to flash your modified firmware: <a href="https://www.microsoft.com/en-us/p/ninebot-flasher/9p5hws0hq55s?activetab=pivot:overviewtab">Ninebot-Flasher</a></b><br>
</p>

<hr>
<p>
    Source code on GitHub: <a href="https://github.com/scooterhacking/ninebot-es-snsc-firmware-patcher" target="_blank">https://github.com/scooterhacking/ninebot-es-snsc-firmware-patcher</a>
    <br>
    <b>Donate to majsi (CFW scripting): <a href="#" target="_blank">to be added</a><br />
	Donate to ScooterHacking.org (host and maintainer): <a href="#" target="_blank">to be added</a><br />
	Donate to Botox: <a href="https://paypal.me/BotoXbz" target="_blank">https://paypal.me/BotoXbz</a></b>
</p>
</div>

<script>
    var forms = {
        "VERSION": "version",
        "KERS_MIN_SPEED": "kers_min_speed",
        "NORMAL_MAX_SPEED": "normal_max_speed",
        "ECO_MAX_SPEED": "eco_max_speed",
        "MOTOR_START_SPEED": "motor_start_speed",
        "MOTOR_POWER_CONSTANT": "motor_power_constant",
        "CRUISE_CONTROL_DELAY": "cruise_control_delay",
        "INSTANT_ECO_SWITCH": "instant_eco_switch",
        "BOOT_WITH_ECO": "boot_with_eco",
        "RUSSIAN_THROTTLE": "russian_throttle",
        "VOLTAGE_LIMIT": "voltage_limit",
        "REMOVE_HARD_SPEED_LIMIT": "remove_hard_speed_limit",
        "REMOVE_CHARGING_MODE": "remove_charging_mode",
        "BMS_UART_76800": "bms_uart_76800",
        "WHEEL_SPEED_CONST": "wheel_speed_const"
    };

    var formValues = Object.values(forms);
    var queryStrings = window.location.search.substring(1);
    var queries = queryStrings.split('&');

    for (var i = 0; i < queries.length; i++) {
        var query = queries[i];
        var tmp = query.split('=');
        var found = false;

        for (var j = 0; j < formValues.length; j++) {
            if (formValues[j] === tmp[0]) {
                found = true;
                break;
            }
        }

        if(found) {
            if (tmp[1] === 'on') {
                tmp[1] = true;
            }

            ChangeForm(tmp[0], tmp[1], true);
        }
    }

    function GetForm(name) {
        return document.getElementsByName(name)[0];
    }

    function GetFormValue(name) {
        var o = GetForm(name);

        if (o.type === "checkbox") {
            return o.checked;
        }

        return o.value;
    }

    function GetPatchCheckBox(name) {
        var form = GetForm(name);
        return form.nextElementSibling && form.nextElementSibling.children[0];
    }

    function CheckForm(name, cb) {
        GetForm(name).disabled = !cb.checked;
    }

    function ChangeForm(name, value, patch) {
        var o = GetForm(name);

        if (o.type === "checkbox") {
            o.checked = value;
        } else {
            o.value = value;
        }

        if (typeof patch === 'boolean') {
            var cb = GetPatchCheckBox(name);

            if (cb) {
                cb.checked = patch;
                cb.onchange();
            }
        }
    }

    function Preset_Default() {
        ChangeForm(forms.VERSION, "DRV138");
        ChangeForm(forms.KERS_MIN_SPEED, "6.0", false);
        ChangeForm(forms.NORMAL_MAX_SPEED, "28", false);
        ChangeForm(forms.ECO_MAX_SPEED, "22", false);
        ChangeForm(forms.MOTOR_START_SPEED, "5.0", false);
        ChangeForm(forms.MOTOR_POWER_CONSTANT, "51575", false);
        ChangeForm(forms.CRUISE_CONTROL_DELAY, "5", false);
        ChangeForm(forms.INSTANT_ECO_SWITCH, false);
        ChangeForm(forms.BOOT_WITH_ECO, false);
        ChangeForm(forms.RUSSIAN_THROTTLE, false);
        ChangeForm(forms.VOLTAGE_LIMIT, "43.01", false);
        ChangeForm(forms.REMOVE_HARD_SPEED_LIMIT, false);
        ChangeForm(forms.REMOVE_CHARGING_MODE, false);
        ChangeForm(forms.BMS_UART_76800, false);
        ChangeForm(forms.WHEEL_SPEED_CONST, 345, false);
    }

    function Preset_Mine() {
        ChangeForm(forms.VERSION, "DRV138");
        ChangeForm(forms.KERS_MIN_SPEED, "40.0", true);
        ChangeForm(forms.NORMAL_MAX_SPEED, "30", true);
        ChangeForm(forms.ECO_MAX_SPEED, "26", true);
        ChangeForm(forms.MOTOR_START_SPEED, "3.0", true);
        ChangeForm(forms.MOTOR_POWER_CONSTANT, "38000", true);
        ChangeForm(forms.CRUISE_CONTROL_DELAY, "5", false);
        ChangeForm(forms.INSTANT_ECO_SWITCH, true);
        ChangeForm(forms.BOOT_WITH_ECO, false);
        ChangeForm(forms.RUSSIAN_THROTTLE, false);
        ChangeForm(forms.VOLTAGE_LIMIT, "52.00", true);
        ChangeForm(forms.REMOVE_HARD_SPEED_LIMIT, true);
        ChangeForm(forms.REMOVE_CHARGING_MODE, false);
        ChangeForm(forms.BMS_UART_76800, false);
        ChangeForm(forms.WHEEL_SPEED_CONST, 345, false);
    }

    function Preset_CFWW() {
        ChangeForm(forms.VERSION, "DRV138");
        ChangeForm(forms.KERS_MIN_SPEED, "46.3", true);
        ChangeForm(forms.NORMAL_MAX_SPEED, "45", true);
        ChangeForm(forms.ECO_MAX_SPEED, "27", true);
        ChangeForm(forms.MOTOR_START_SPEED, "1.45", true);
        ChangeForm(forms.MOTOR_POWER_CONSTANT, "27877", true);
        ChangeForm(forms.CRUISE_CONTROL_DELAY, "5", false);
        ChangeForm(forms.INSTANT_ECO_SWITCH, false);
        ChangeForm(forms.BOOT_WITH_ECO, false);
        ChangeForm(forms.RUSSIAN_THROTTLE, true);
        ChangeForm(forms.VOLTAGE_LIMIT, "52.00", true);
        ChangeForm(forms.REMOVE_HARD_SPEED_LIMIT, false);
        ChangeForm(forms.REMOVE_CHARGING_MODE, false);
        ChangeForm(forms.BMS_UART_76800, false);
        ChangeForm(forms.WHEEL_SPEED_CONST, 345, false);
    }

    function Preset_Rollerplausch() {
        ChangeForm(forms.VERSION, "DRV138");
        ChangeForm(forms.KERS_MIN_SPEED, "40.0", true);
        ChangeForm(forms.NORMAL_MAX_SPEED, "30", true);
        ChangeForm(forms.ECO_MAX_SPEED, "19", true);
        ChangeForm(forms.MOTOR_START_SPEED, "3.0", true);
        ChangeForm(forms.MOTOR_POWER_CONSTANT, "33000", true);
        ChangeForm(forms.CRUISE_CONTROL_DELAY, "5", false);
        ChangeForm(forms.INSTANT_ECO_SWITCH, true);
        ChangeForm(forms.BOOT_WITH_ECO, true);
        ChangeForm(forms.RUSSIAN_THROTTLE, false);
        ChangeForm(forms.VOLTAGE_LIMIT, "43.01", false);
        ChangeForm(forms.REMOVE_HARD_SPEED_LIMIT, true);
        ChangeForm(forms.REMOVE_CHARGING_MODE, true);
        ChangeForm(forms.BMS_UART_76800, false);
        ChangeForm(forms.WHEEL_SPEED_CONST, 345, false);
    }

    function Preset_DYoC() {
        ChangeForm(forms.VERSION, "DRV138");
        ChangeForm(forms.KERS_MIN_SPEED, "6.0", false);
        ChangeForm(forms.NORMAL_MAX_SPEED, "31", true);
        ChangeForm(forms.ECO_MAX_SPEED, "20", true);
        ChangeForm(forms.MOTOR_START_SPEED, "2.0", true);
        ChangeForm(forms.MOTOR_POWER_CONSTANT, "40165", true);
        ChangeForm(forms.CRUISE_CONTROL_DELAY, "5", false);
        ChangeForm(forms.INSTANT_ECO_SWITCH, false);
        ChangeForm(forms.BOOT_WITH_ECO, false);
        ChangeForm(forms.RUSSIAN_THROTTLE, false);
        ChangeForm(forms.VOLTAGE_LIMIT, "52.00", true);
        ChangeForm(forms.REMOVE_HARD_SPEED_LIMIT, false);
        ChangeForm(forms.REMOVE_CHARGING_MODE, false);
        ChangeForm(forms.BMS_UART_76800, false);
        ChangeForm(forms.WHEEL_SPEED_CONST, 345, false);
    }

    function Share() {
        var url = location.protocol + '//' + location.host;
        var firstParam = true;

        function getSeparator() {
            if (firstParam) {
                firstParam = false;
                return '?';
            }

            return '&';
        }

        for (var i = 0; i < formValues.length; i++) {
            var form = formValues[i];

            var formValue = GetFormValue(form);
            var patchCheckbox = GetPatchCheckBox(form);

            if (patchCheckbox) {
                if (patchCheckbox.checked) {
                    url += getSeparator() + form + '=' + formValue;
                }
            } else if (typeof formValue === 'boolean') {
                if (formValue) {
                    url += getSeparator() + form + '=on';
                }
            } else {
                url += getSeparator() + form + '=' + formValue;
            }
        }

        var textArea = document.createElement("textarea");

        textArea.value = url;
        document.body.appendChild(textArea);

        textArea.focus();
        textArea.select();

        document.execCommand('copy');
        document.getElementById('shareConfirmation').innerText = 'Copied!';

        document.body.removeChild(textArea);
    }
</script>
<script type="text/javascript">
alert("Don't get too excited, it's not working yet.");
</script>
</body>
